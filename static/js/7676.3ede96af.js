"use strict";(self.webpackChunkdexguru=self.webpackChunkdexguru||[]).push([[7676],{43883:(e,r,t)=>{t.d(r,{i:()=>n});const n="providers/5.7.2"},57676:(e,r,t)=>{t.d(r,{H:()=>B});var n=t(12442),o=t(82895),i=t(80928),s=t(99138),l=t(27547),c=t(99610),a=t(81209),u=t(77107),g=t(78663),h=t(43883),d=function(e,r,t,n){return new(t||(t=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(r){i(r)}}function l(e){try{c(n.throw(e))}catch(r){i(r)}}function c(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(s,l)}c((n=n.apply(e,r||[])).next())}))};const f=new g.Logger(h.i);function m(){return(new Date).getTime()}function p(e){let r=null;for(let t=0;t<e.length;t++){const n=e[t];if(null==n)return null;r?r.name===n.name&&r.chainId===n.chainId&&(r.ensAddress===n.ensAddress||null==r.ensAddress&&null==n.ensAddress)||f.throwArgumentError("provider mismatch","networks",e):r=n}return r}function b(e,r){e=e.slice().sort();const t=Math.floor(e.length/2);if(e.length%2)return e[t];const n=e[t-1],o=e[t];return null!=r&&Math.abs(n-o)>r?null:(n+o)/2}function k(e){if(null===e)return"null";if("number"===typeof e||"boolean"===typeof e)return JSON.stringify(e);if("string"===typeof e)return e;if(o.O$.isBigNumber(e))return e.toString();if(Array.isArray(e))return JSON.stringify(e.map((e=>k(e))));if("object"===typeof e){const r=Object.keys(e);return r.sort(),"{"+r.map((r=>{let t=e[r];return t="function"===typeof t?"[function]":k(t),JSON.stringify(r)+":"+t})).join(",")+"}"}throw new Error("unknown value type: "+typeof e)}let w=1;function y(e){let r=null,t=null,n=new Promise((n=>{r=function(){t&&(clearTimeout(t),t=null),n()},t=setTimeout(r,e)}));return{cancel:r,getPromise:function(){return n},wait:e=>(n=n.then(e),n)}}const T=[g.Logger.errors.CALL_EXCEPTION,g.Logger.errors.INSUFFICIENT_FUNDS,g.Logger.errors.NONCE_EXPIRED,g.Logger.errors.REPLACEMENT_UNDERPRICED,g.Logger.errors.UNPREDICTABLE_GAS_LIMIT],v=["address","args","errorArgs","errorSignature","method","transaction"];function E(e,r){const t={weight:e.weight};return Object.defineProperty(t,"provider",{get:()=>e.provider}),e.start&&(t.start=e.start),r&&(t.duration=r-e.start),e.done&&(e.error?t.error=e.error:t.result=e.result||null),t}function N(e,r,t){let n=k;switch(r){case"getBlockNumber":return function(r){const t=r.map((e=>e.result));let n=b(r.map((e=>e.result)),2);if(null!=n)return n=Math.ceil(n),t.indexOf(n+1)>=0&&n++,n>=e._highestBlockNumber&&(e._highestBlockNumber=n),e._highestBlockNumber};case"getGasPrice":return function(e){const r=e.map((e=>e.result));return r.sort(),r[Math.floor(r.length/2)]};case"getEtherPrice":return function(e){return b(e.map((e=>e.result)))};case"getBalance":case"getTransactionCount":case"getCode":case"getStorageAt":case"call":case"estimateGas":case"getLogs":break;case"getTransaction":case"getTransactionReceipt":n=function(e){return null==e?null:((e=(0,s.shallowCopy)(e)).confirmations=-1,k(e))};break;case"getBlock":n=t.includeTransactions?function(e){return null==e?null:((e=(0,s.shallowCopy)(e)).transactions=e.transactions.map((e=>((e=(0,s.shallowCopy)(e)).confirmations=-1,e))),k(e))}:function(e){return null==e?null:k(e)};break;default:throw new Error("unknown method: "+r)}return function(e,r){return function(t){const n={};t.forEach((r=>{const t=e(r.result);n[t]||(n[t]={count:0,result:r.result}),n[t].count++}));const o=Object.keys(n);for(let e=0;e<o.length;e++){const t=n[o[e]];if(t.count>=r)return t.result}}}(n,e.quorum)}function C(e,r){return d(this,void 0,void 0,(function*(){const t=e.provider;return null!=t.blockNumber&&t.blockNumber>=r||-1===r?t:(0,c.$l)((()=>new Promise(((n,o)=>{setTimeout((function(){return t.blockNumber>=r?n(t):e.cancelled?n(null):n(void 0)}),0)}))),{oncePoll:t})}))}function P(e,r,t,n){return d(this,void 0,void 0,(function*(){let o=e.provider;switch(t){case"getBlockNumber":case"getGasPrice":return o[t]();case"getEtherPrice":if(o.getEtherPrice)return o.getEtherPrice();break;case"getBalance":case"getTransactionCount":case"getCode":return n.blockTag&&(0,i.isHexString)(n.blockTag)&&(o=yield C(e,r)),o[t](n.address,n.blockTag||"latest");case"getStorageAt":return n.blockTag&&(0,i.isHexString)(n.blockTag)&&(o=yield C(e,r)),o.getStorageAt(n.address,n.position,n.blockTag||"latest");case"getBlock":return n.blockTag&&(0,i.isHexString)(n.blockTag)&&(o=yield C(e,r)),o[n.includeTransactions?"getBlockWithTransactions":"getBlock"](n.blockTag||n.blockHash);case"call":case"estimateGas":return n.blockTag&&(0,i.isHexString)(n.blockTag)&&(o=yield C(e,r)),"call"===t&&n.blockTag?o[t](n.transaction,n.blockTag):o[t](n.transaction);case"getTransaction":case"getTransactionReceipt":return o[t](n.transactionHash);case"getLogs":{let t=n.filter;return(t.fromBlock&&(0,i.isHexString)(t.fromBlock)||t.toBlock&&(0,i.isHexString)(t.toBlock))&&(o=yield C(e,r)),o.getLogs(t)}}return f.throwError("unknown method error",g.Logger.errors.UNKNOWN_ERROR,{method:t,params:n})}))}class B extends a.Zk{constructor(e,r){0===e.length&&f.throwArgumentError("missing providers","providers",e);const t=e.map(((e,r)=>{if(n.zt.isProvider(e)){const r=(0,u.Gp)(e)?2e3:750,t=1;return Object.freeze({provider:e,weight:1,stallTimeout:r,priority:t})}const t=(0,s.shallowCopy)(e);null==t.priority&&(t.priority=1),null==t.stallTimeout&&(t.stallTimeout=(0,u.Gp)(e)?2e3:750),null==t.weight&&(t.weight=1);const o=t.weight;return(o%1||o>512||o<1)&&f.throwArgumentError("invalid weight; must be integer in [1, 512]",`providers[${r}].weight`,o),Object.freeze(t)})),o=t.reduce(((e,r)=>e+r.weight),0);null==r?r=o/2:r>o&&f.throwArgumentError("quorum will always fail; larger than total weight","quorum",r);let i=p(t.map((e=>e.provider.network)));null==i&&(i=new Promise(((e,r)=>{setTimeout((()=>{this.detectNetwork().then(e,r)}),0)}))),super(i),(0,s.defineReadOnly)(this,"providerConfigs",Object.freeze(t)),(0,s.defineReadOnly)(this,"quorum",r),this._highestBlockNumber=-1}detectNetwork(){return d(this,void 0,void 0,(function*(){return p(yield Promise.all(this.providerConfigs.map((e=>e.provider.getNetwork()))))}))}perform(e,r){return d(this,void 0,void 0,(function*(){if("sendTransaction"===e){const e=yield Promise.all(this.providerConfigs.map((e=>e.provider.sendTransaction(r.signedTransaction).then((e=>e.hash),(e=>e)))));for(let r=0;r<e.length;r++){const t=e[r];if("string"===typeof t)return t}throw e[0]}-1===this._highestBlockNumber&&"getBlockNumber"!==e&&(yield this.getBlockNumber());const t=N(this,e,r),n=(0,l.y)(this.providerConfigs.map(s.shallowCopy));n.sort(((e,r)=>e.priority-r.priority));const o=this._highestBlockNumber;let i=0,c=!0;for(;;){const l=m();let a=n.filter((e=>e.runner&&l-e.start<e.stallTimeout)).reduce(((e,r)=>e+r.weight),0);for(;a<this.quorum&&i<n.length;){const t=n[i++],l=w++;t.start=m(),t.staller=y(t.stallTimeout),t.staller.wait((()=>{t.staller=null})),t.runner=P(t,o,e,r).then((n=>{t.done=!0,t.result=n,this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:l,backend:E(t,m()),request:{method:e,params:(0,s.deepCopy)(r)},provider:this})}),(n=>{t.done=!0,t.error=n,this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:l,backend:E(t,m()),request:{method:e,params:(0,s.deepCopy)(r)},provider:this})})),this.listenerCount("debug")&&this.emit("debug",{action:"request",rid:l,backend:E(t,null),request:{method:e,params:(0,s.deepCopy)(r)},provider:this}),a+=t.weight}const u=[];n.forEach((e=>{!e.done&&e.runner&&(u.push(e.runner),e.staller&&u.push(e.staller.getPromise()))})),u.length&&(yield Promise.race(u));const g=n.filter((e=>e.done&&null==e.error));if(g.length>=this.quorum){const e=t(g);if(void 0!==e)return n.forEach((e=>{e.staller&&e.staller.cancel(),e.cancelled=!0})),e;c||(yield y(100).getPromise()),c=!1}const h=n.reduce(((e,r)=>{if(!r.done||null==r.error)return e;const t=r.error.code;return T.indexOf(t)>=0&&(e[t]||(e[t]={error:r.error,weight:0}),e[t].weight+=r.weight),e}),{});if(Object.keys(h).forEach((e=>{const r=h[e];if(r.weight<this.quorum)return;n.forEach((e=>{e.staller&&e.staller.cancel(),e.cancelled=!0}));const t=r.error,o={};v.forEach((e=>{null!=t[e]&&(o[e]=t[e])})),f.throwError(t.reason||t.message,e,o)})),0===n.filter((e=>!e.done)).length)break}return n.forEach((e=>{e.staller&&e.staller.cancel(),e.cancelled=!0})),f.throwError("failed to meet quorum",g.Logger.errors.SERVER_ERROR,{method:e,params:r,results:n.map((e=>E(e))),provider:this})}))}}}}]);